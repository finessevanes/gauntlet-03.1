# Memory Bank — Gauntlet-03 (Klippy)

**Must read at session start** for project context.

---

## 1. Project Overview

**Project:** Klippy — Desktop Video Editor (MVP)
**Type:** Native desktop application (Electron + React)
**Status:** Documentation complete, features pending
**Target:** Ship MVP with 8 core features

### Core Features (8 total, 4 phases)

**Phase 1: Foundation**
- REQ-1: Application Launch (<5sec, FFmpeg bundled, restore session)
- REQ-2: Video Import (drag-drop, file picker, MP4/MOV only)

**Phase 2: Core Editing**
- REQ-3: Library View (thumbnails, durations, scrolling)
- REQ-4: Timeline View (drag clips, reorder, snap, zoom)

**Phase 3: Edit & Preview**
- REQ-5: Trim Functionality (adjust in/out points, real-time preview)
- REQ-6: Preview Player (play/pause, seek, scrubbing, 30fps min)

**Phase 4: Export & Polish**
- REQ-7: Export (MP4, progress, cancel, error handling)
- REQ-8: Session Persistence (save/restore timeline state)

---

## 2. Tech Stack

**Frontend:** React + TypeScript + Vite
**Backend:** Electron (Node.js main process) for system integration
**Video Processing:** FFmpeg (bundled via ffmpeg-static npm package)
**Build:** npm
**Platform:** macOS (primary), Windows (secondary)

### Key Dependencies
- FFmpeg: Video import, trim, export operations
- Electron: File system, process management, window control via IPC
- React Hooks: State management (Context, custom hooks)
- HTML5 `<video>` element: Video playback

---

## 3. Agent System

### The Team: Brenda → Pam → Caleb

**Brenda (User Story Creator)**
- Reads prd-mvp.md, breaks down into user stories
- Format: "As a... I want... So that..."
- Output: Acceptance criteria, complexity, phase, dependencies
- Command: `/brenda prd-mvp.md` or `/brenda [feature-name]`

**Pam (PRD & TODO Creator)**
- Takes user story, creates detailed PRD + TODO
- PRD: 12 sections (Preflight → Risks & Mitigations)
- TODO: 8 sections (Pre-Implementation → PR & Merge)
- Output: prds/[feature]-prd.md + todos/[feature]-todo.md
- Command: `/pam [feature-name]`

**Caleb (Implementation Coder)**
- Reads user story, PRD, TODO
- Implements in TODO order
- Checks off tasks, verifies gates, waits for user test
- Commits and creates PR to develop
- Command: `/caleb [feature-name]`

### Workflow

```
Brenda creates user stories (prd-mvp.md)
     ↓
Pam creates PRD + TODO per story
     ↓
Caleb implements (can run in parallel)
     ↓
PR to develop branch
```

---

## 4. Key Documents

### Always Reference

**prd-mvp.md** — Source of truth
- 8 features fully specified
- All testing gates defined
- Non-functional requirements (performance, platform support)
- FFmpeg integration strategy

**agents/prd-template.md** — PRD format
- 12 sections: Preflight, Summary, Scope, UX, Requirements, Data Model, APIs, Components, Integration, Testing, Definition of Done, Risks

**agents/todo-template.md** — TODO format
- 8 sections: Pre-Implementation, Service Layer, Components, Data Model, Integration, Testing, Performance, Definition of Done, PR & Merge

**agents/brenda-agent.md, pam-agent.md, caleb-agent.md** — Agent instructions

### Data Organization

```
agents/
├── brenda-agent.md      # Creates user stories
├── pam-agent.md         # Creates PRD + TODO
├── caleb-agent.md       # Implements features
├── prd-template.md      # PRD format
└── todo-template.md     # TODO format

prds/                     # Generated by Pam
├── [feature-1]-prd.md
├── [feature-2]-prd.md
└── ... (8 total)

todos/                    # Generated by Pam
├── [feature-1]-todo.md
├── [feature-2]-todo.md
└── ... (8 total)
```

---

## 5. Build Dependencies (Order Matters!)

Build features in phase order:

**Phase 1 first** (Foundation)
1. Application Launch — Must work before importing videos
2. Video Import — Library depends on this

**Phase 2 next** (Core Editing)
3. Library View — Requires imported clips
4. Timeline View — Requires library

**Phase 3 after** (Edit & Preview)
5. Trim Functionality — Modifies timeline clips
6. Preview Player — Shows timeline playback

**Phase 4 last** (Export & Polish)
7. Export — Uses final timeline
8. Session Persistence — Restores at launch

---

## 6. Critical Patterns

### Electron IPC (Backend ↔ Frontend)

All backend logic goes in the Electron main process (Node.js):
- File operations (import, export, save)
- FFmpeg integration (metadata, trim, export)
- System operations (window, filesystem)

React frontend invokes via `ipcRenderer.invoke()`:
```typescript
import { ipcRenderer } from "electron";
const result = await ipcRenderer.invoke("command_name", { param: value });
```

### React State Management

- **Local state**: `useState` for UI-only state (loading, UI toggles)
- **Custom hooks**: `useLibrary()`, `useTimeline()`, etc. for feature state
- **Context** (if needed): Global state across multiple components

### Error Handling

Every operation must handle:
- **Invalid input**: File not found, corrupted video, missing metadata
- **System constraints**: Disk space, memory, permissions
- **User feedback**: Clear error messages in UI (no technical jargon)

### Testing Gates (From prd-mvp.md)

Each feature has:
1. **Happy Path**: Main user flow works end-to-end
2. **Edge Cases**: Special scenarios (empty input, large files, unicode)
3. **Error Handling**: Invalid input, missing files, disk full

---

## 7. Performance Targets

| Target | Specification |
|--------|---------------|
| App Launch | < 5 seconds |
| Timeline Responsiveness | < 50ms for drag operations |
| Playback | ≥ 30fps minimum |
| Memory | < 1GB with 10+ clips |
| Export Time | 2-min 1080p video < 5 min |
| Scrubbing | Preview updates within 100ms |

---

## 8. Git Workflow

**Base branch:** `develop` (never `main`)
**Branch naming:** `feat/{feature-slug}` (e.g., `feat/video-import`)
**PR target:** Always `develop`

**Commit strategy:**
- Group related changes (e.g., all Service Layer code together)
- Commit example: `feat: add video_import IPC handler with validation`
- Multiple commits per PR are OK (one per logical section)

---

## 9. Quick Start Commands

### Build Single Feature
```bash
/brenda video-import           # Creates user story
/pam video-import              # Creates PRD + TODO
/caleb video-import            # Implements
```

### Build All Features
```bash
/brenda prd-mvp.md              # Breaks down into 8 user stories
# Then for each:
/pam [feature-1]
/caleb [feature-1]
```

---

## 10. Success Criteria

**Per Feature (User Story):**
- ✅ Acceptance criteria met
- ✅ All test gates pass (happy path, edge cases, errors)
- ✅ No console errors
- ✅ Code has comments for complex logic
- ✅ User tested and approved

**Overall MVP:**
- ✅ All 8 features complete
- ✅ All phases (1-4) shipped
- ✅ Cross-platform (macOS + Windows tested)
- ✅ Performance targets met
- ✅ User can: import → edit → export video end-to-end

---

**Last Updated:** October 27, 2025
**Next Step:** Start with Phase 1 features (Application Launch + Video Import)
