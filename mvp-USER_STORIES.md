# Klippy MVP - User Stories

**Version**: 1.0
**Date**: October 27, 2025
**Product**: Klippy Desktop Video Editor
**Generated by**: Brenda (Feature Strategist)

---

## Overview

This document breaks down the Klippy MVP PRD into 8 detailed user stories, each with acceptance criteria, complexity levels, and phase assignments. Stories are organized by build sequence and dependencies.

---

## User Stories

### **Story 1: Application Launch**
**Phase**: 1 | **Complexity**: Simple | **Feature**: REQ-1

**As a** user,
**I want** the Klippy app to launch quickly and restore my previous editing session,
**So that** I can pick up where I left off without losing my clips and timeline arrangement.

**Acceptance Criteria:**
- [ ] App launches on macOS in under 5 seconds
- [ ] FFmpeg binary is bundled (no external dependencies required)
- [ ] On first launch, app shows empty state (no clips, blank timeline)
- [ ] On subsequent launch, app restores previous session:
  - All previously imported clips appear in Library
  - Timeline clip order and positions match last session
  - Zoom level and scroll position are preserved
- [ ] If session state file is corrupted, app launches with blank slate and logs error
- [ ] If FFmpeg binary is missing/corrupted, error dialog appears with reinstall instructions

**Dependencies**: None (foundation feature)

---

### **Story 2: Video Import**
**Phase**: 1 | **Complexity**: Medium | **Feature**: REQ-2

**As a** user,
**I want** to import video files (MP4, MOV) into Klippy via drag-and-drop or file picker,
**So that** I can build a library of clips to edit.

**Acceptance Criteria:**
- [ ] Drag & drop multiple MP4/MOV files into app window → all appear in Library
- [ ] Click "Import" button → file picker opens filtered to .mp4 and .mov only
- [ ] File picker rejects unsupported formats (HEVC, ProRes, AV1, WebM, etc.)
- [ ] Each imported clip displays in Library with:
  - Thumbnail (first frame of video)
  - Filename
  - Duration in MM:SS format
- [ ] Same file can be imported multiple times (duplicates allowed)
- [ ] App stores file paths (linked files, not embedded in project)
- [ ] Import handles corrupted MP4 files gracefully → shows error: "Unable to read file: [filename]"
- [ ] Large files (up to 2GB tested) can be imported without crashes
- [ ] Import UI shows loading spinner: "Importing [filename]..."

**Dependencies**: Story 1 (must have app framework)

---

### **Story 3: Library View**
**Phase**: 2 | **Complexity**: Simple | **Feature**: REQ-3

**As a** user,
**I want** to see all my imported clips in an organized Library view,
**So that** I can quickly find and select clips to add to the timeline.

**Acceptance Criteria:**
- [ ] Library displays all imported clips in a scrollable list/grid (left panel, ~20% width)
- [ ] Each clip card shows:
  - Thumbnail (first frame)
  - Filename
  - Duration (MM:SS format)
- [ ] Click on a clip in Library → plays that clip only in preview player
- [ ] Drag a clip from Library → can be dragged to Timeline to add it
- [ ] Library with 20+ clips remains scrollable and performant
- [ ] Empty state displays: "Drag & drop video files or click Import to get started" (with icon)
- [ ] If source file is moved/deleted after import, Library shows broken file icon with tooltip

**Dependencies**: Story 2 (must have imported clips)

---

### **Story 4: Timeline View**
**Phase**: 2 | **Complexity**: Medium | **Feature**: REQ-4

**As a** user,
**I want** to arrange imported clips on a visual timeline and reorder them,
**So that** I can construct the sequence of my final video.

**Acceptance Criteria:**
- [ ] Timeline displays horizontal track (bottom panel, 30% height, full width)
- [ ] Clip blocks display with visual width proportional to duration
- [ ] Red vertical playhead shows current time position
- [ ] Timecode display shows HH:MM:SS.mmm format above timeline
- [ ] Drag clips from Library onto Timeline → they appear in sequence
- [ ] Drag clip horizontally on Timeline → reorder clips (no gaps, no overlaps)
- [ ] Right-click on clip → Delete option; or press Delete key → clip removed
- [ ] Clips snap together automatically (no gaps between clips)
- [ ] Zoom slider (100%-1000%) controls timeline view:
  - 100% = ~1 pixel per second
  - 1000% = ~10 pixels per second
- [ ] Default zoom on load: Auto-fit (entire timeline visible without scroll)
- [ ] When zoomed in, horizontal scroll is enabled
- [ ] Timeline with 10+ clips (30min total) → auto-fit displays all clips
- [ ] Empty timeline shows: "Drag clips here to start editing"

**Dependencies**: Story 3 (must have Library to drag from)

---

### **Story 5: Trim Functionality**
**Phase**: 3 | **Complexity**: Medium | **Feature**: REQ-5

**As a** user,
**I want** to trim clips on the timeline to adjust their start and end points,
**So that** I can remove unwanted portions without modifying original files.

**Acceptance Criteria:**
- [ ] Hover over clip edge (start or end) → cursor changes to resize (↔)
- [ ] Click + drag edge → adjust in/out point (frame-precise, no snap to seconds)
- [ ] Real-time visual feedback: clip block width updates while dragging
- [ ] Tooltip shows updated duration during drag (e.g., "0:45 → 0:30")
- [ ] Dragging start point past end point → UI prevents or snaps to valid range
- [ ] Trimmed clip duration displays on the clip block
- [ ] Original video file remains unchanged (non-destructive editing)
- [ ] Import 1-minute clip → trim to 30 seconds → timeline updates
- [ ] Trim multiple clips to different lengths → export succeeds with correct durations

**Dependencies**: Story 4 (must have Timeline)

---

### **Story 6: Preview Player**
**Phase**: 3 | **Complexity**: Medium | **Feature**: REQ-6

**As a** user,
**I want** to preview my timeline sequence with a video player that shows audio and supports playback controls,
**So that** I can verify my edits before exporting.

**Acceptance Criteria:**
- [ ] Preview player displays current frame at playhead position (center panel, ~40% width)
- [ ] Playback controls: Play button, Pause button, Seek bar
- [ ] Audio is enabled: plays video + audio track synced
- [ ] Click Play → plays from current playhead through all timeline clips in sequence
- [ ] Click on timeline or seek bar → updates playhead position and preview frame
- [ ] Drag playhead → updates preview in real-time (scrubbing) within 100ms response time
- [ ] Click on clip in Library → plays that clip only in preview (not entire timeline)
- [ ] Playback achieves minimum 30fps (smooth motion, no stuttering)
- [ ] Playing timeline with 10+ clips → remains smooth at 30fps minimum
- [ ] Corrupted video frame → skips frame, continues playback (no crash)

**Dependencies**: Story 4 (Timeline) + Story 3 (Library)

---

### **Story 7: Export to MP4**
**Phase**: 4 | **Complexity**: Complex | **Feature**: REQ-7

**As a** user,
**I want** to export my timeline as a final MP4 video file to my computer,
**So that** I can share or archive my edited video.

**Acceptance Criteria:**
- [ ] Click "Export" button → save file dialog opens
- [ ] Default filename: `Klippy_Export_YYYYMMDD_HHMMSS.mp4`
- [ ] User selects save location and confirms
- [ ] Export settings (fixed preset):
  - Codec: H.264 (libx264)
  - Resolution: Match highest source (max 1080p)
  - Frame rate: 30fps
  - Bitrate: ~5Mbps for 1080p
  - Audio: AAC, 128kbps
- [ ] Export progress modal shows:
  - Progress bar (0-100%)
  - Estimated time remaining
  - Cancel button
- [ ] Cancel button stops export immediately and deletes partial output file
- [ ] Before export, validate all source files exist; if missing → error: "Cannot export: [filename] not found"
- [ ] Export fails → show FFmpeg error message in dialog
- [ ] Mixed frame rates (30fps vs 60fps) → export at 30fps
- [ ] Mixed resolutions (1080p vs 720p) → export at 1080p, upscale 720p
- [ ] Mixed aspect ratios → export matches first clip, letterbox others
- [ ] Single 1-minute clip export → completes without crash
- [ ] 3 clips (2-minute total) export → output file is exactly 2 minutes
- [ ] Timeline with 0 clips → error: "Add at least one clip to export"
- [ ] 1-second clip export succeeds
- [ ] Exported video plays correctly in external player with synced audio

**Dependencies**: Story 4 (Timeline) + Story 5 (Trim)

---

### **Story 8: Session State Persistence**
**Phase**: 4 | **Complexity**: Simple | **Feature**: REQ-8

**As a** user,
**I want** my timeline and imported clips to persist between app launches,
**So that** I don't lose my work if I close and reopen the app.

**Acceptance Criteria:**
- [ ] On app close, save to local storage:
  - List of imported clips (file paths, current trim points)
  - Timeline clip order and positions
  - Zoom level and scroll position
- [ ] On app launch, automatically restore saved state
- [ ] If timeline has clips and user quits → show warning: "Unsaved work will be lost. Quit anyway?"
- [ ] If timeline is empty and user quits → no warning shown
- [ ] Quit with 3 clips on timeline → close app → relaunch → timeline is restored exactly
- [ ] If state file is corrupted → launch with blank slate and log error
- [ ] Zoom and scroll position preserved across sessions

**Dependencies**: Story 1 (App Launch) + Story 4 (Timeline)

---

## Summary Table

| # | Story | Phase | Complexity | Dependencies |
|----|-------|-------|------------|--------------|
| 1 | Application Launch | 1 | Simple | None |
| 2 | Video Import | 1 | Medium | Story 1 |
| 3 | Library View | 2 | Simple | Story 2 |
| 4 | Timeline View | 2 | Medium | Story 3 |
| 5 | Trim Functionality | 3 | Medium | Story 4 |
| 6 | Preview Player | 3 | Medium | Story 4, 3 |
| 7 | Export to MP4 | 4 | Complex | Story 4, 5 |
| 8 | Session Persistence | 4 | Simple | Story 1, 4 |

---

## Build Sequence (Respects Dependencies)

### **Phase 1: Foundation**
1. **Story 1: Application Launch** - Set up Electron app, FFmpeg bundling, session restoration
2. **Story 2: Video Import** - Drag & drop + file picker, metadata extraction

### **Phase 2: Core Editing**
3. **Story 3: Library View** - Display imported clips, thumbnails, clip preview playback
4. **Story 4: Timeline View** - Drag clips to timeline, reorder, delete, zoom/scroll

### **Phase 3: Preview & Edit**
5. **Story 5: Trim Functionality** - Edge drag to adjust in/out points, real-time feedback
6. **Story 6: Preview Player** - Play timeline sequence, seek, scrub with audio

### **Phase 4: Export & Polish**
7. **Story 7: Export to MP4** - FFmpeg integration, progress modal, mixed source handling
8. **Story 8: Session Persistence** - Save/restore state on close/launch

---

## Next Steps

**Workflow: Brenda → Pam → Caleb (no redundancy)**

1. **Brenda Phase** (✅ Complete): User stories + acceptance criteria extracted from `prd-mvp.md` testing gates

2. **Pam Phase**: For each story, run `/pam s[#]-[story-name]` to generate detailed PRD:
   - **Input**: User story (acceptance criteria already validated against prd-mvp.md by Brenda)
   - **Output**: `prds/s[#]-[story-name]-prd.md` with preflight, scope, UX flow, functional requirements, data model, APIs, test gates
   - **Note**: Pam does NOT re-reference prd-mvp.md; accepts Brenda's acceptance criteria as authoritative

3. **Caleb Phase**: For each story, run `/caleb s[#]-[story-name]` to implement:
   - **Input**: User story + PRD (which contains all acceptance gates from Brenda)
   - **Output**:
     - `todos/s[#]-[story-name]-todo.md` — Implementation breakdown
     - Electron main process (IPC handlers in `src/main/`)
     - React frontend (components in `src/components/`)
   - **Note**: Caleb references PRD test gates (Section 10), not prd-mvp.md directly

4. **Parallel Build**: Once PRDs/TODOs are created, features can be built in parallel within phase dependencies.

---

**Document Status**: Ready for PRD Generation
**Reference**: `agents/brenda-agent.md` (source of truth for acceptance criteria), `agents/pam-agent.md`, `agents/caleb-agent.md`
**Note**: `prd-mvp.md` is referenced only by Brenda; Pam and Caleb follow the chain without redundancy

